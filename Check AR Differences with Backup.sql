SELECT	R1.CUSTNMBR,
		R1.DOCNUMBR,
		R1.ORTRXAMT AS DocumentAmount,
		R1.CURTRXAM AS BackupBalance,
		R2.CURTRXAM AS ProductionBalance,
		AppliedOpenBackup = (SELECT SUM(AppToAmt) FROM RM20201 WHERE RM20201.CustNmbr = R1.CustNmbr AND RM20201.ApToDcNm = R1.DocNumbr),
		AppliedHistBackup = (SELECT SUM(AppToAmt) FROM RM30201 WHERE RM30201.CustNmbr = R1.CustNmbr AND RM30201.ApToDcNm = R1.DocNumbr),
		AppliedOpenProduction = (SELECT SUM(AppToAmt) FROM RM20201 WHERE RM20201.CustNmbr = R2.CustNmbr AND RM20201.ApToDcNm = R2.DocNumbr),
		AppliedHistProduction = (SELECT SUM(AppToAmt) FROM RM30201 WHERE RM30201.CustNmbr = R2.CustNmbr AND RM30201.ApToDcNm = R2.DocNumbr)
FROM	RM20101 R1
		INNER JOIN IMC.dbo.RM20101 R2 ON R1.CUSTNMBR = R2.CUSTNMBR AND R1.DOCNUMBR = R2.DOCNUMBR
WHERE	R1.CURTRXAM <> R2.CURTRXAM
ORDER BY 
		R1.CUSTNMBR,
		R1.DOCNUMBR