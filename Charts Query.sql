DECLARE	@tblData Table
	([Customer Number]	Varchar(25),
	[Customer Name]		Varchar(75),
	Current_Outstanding	Numeric(12,2),
	Days31_60			Numeric(12,2),
	Days61_90			Numeric(12,2),
	Days91_180			Numeric(12,2),
	Days180More			Numeric(12,2),
	[Transaction Type]	Varchar(10),
	[Company Name]		Varchar(50))

SELECT	* 
FROM (
	SELECT	* 
	FROM    (
		SELECT	* 
		FROM	(
				SELECT	DATA.CUSTNMBR AS "Customer Number",
						DATA.CUSTNAME AS "Customer Name",
						SUM(DATA.[Current]) AS Current_Outstanding,
						SUM(DATA.[Days31_60]) AS Days31_60,
						SUM(DATA.[Days61_90]) AS Days61_90,
						SUM(DATA.[Days91_180]) AS Days91_180,
						SUM(DATA.[Days180More]) AS Days180More,
						DATA.TRXTYPE AS "Transaction Type",
						CPY.CompanyName AS "Company Name"
				FROM	(
						SELECT	RTRIM(RM2.CUSTNMBR) AS CUSTNMBR,
								CUS.CUSTNAME,
								SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) <= 30 THEN RM2.CURTRXAM ELSE 0 END) AS [Current],
								SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 31 AND 60 THEN RM2.CURTRXAM ELSE 0 END) AS [Days31_60],
								SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 61 AND 90 THEN RM2.CURTRXAM ELSE 0 END) AS [Days61_90],
								SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 91 AND 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days91_180],
								SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) > 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days180More],
								RM2.TRXTYPE
						FROM	(
								SELECT	CUSTNMBR,
										DUEDATE,
										CURTRXAM,
										TRXTYPE,
										BALANCE
								FROM	(
										SELECT	OPE.CUSTNMBR,
												OPE.DOCNUMBR,
												OPE.RMDTYPAL,
												OPE.DOCDATE,
												CASE WHEN OPE.RMDTYPAL < 6 THEN OPE.DOCDATE ELSE CASE WHEN OPE.DUEDATE < '01/01/1980' THEN CASE WHEN DAY.Days = 0 THEN CAST(GetDate() AS Varchar) ELSE DATEADD(dd, DAY.Days, OPE.DOCDATE) END ELSE OPE.DUEDATE END END AS DUEDATE,
												OPE.CURTRXAM * CASE WHEN OPE.RMDTYPAL > 6 THEN -1 ELSE 1 END AS CURTRXAM,
												BALANCE = OPE.CURTRXAM,
												CASE WHEN OPE.RMDTYPAL > 6 THEN 'Credit' ELSE 'Debit' END AS TRXTYPE
										FROM	IMC.dbo.RM20101 OPE
												INNER JOIN (
															SELECT CUSTNMBR,
																	ISNULL(PAYT.DUEDTDS, 0) AS Days
															FROM	IMC.dbo.RM00101 CUST
																	LEFT JOIN IMC.dbo.SY03300 PAYT ON CUST.PYMTRMID = PAYT.PYMTRMID
															) DAY ON OPE.CUSTNMBR = DAY.CUSTNMBR
										WHERE	OPE.VOIDSTTS = 0 
												AND OPE.CURTRXAM <> 0
										) DATA
								WHERE	ISNULL(BALANCE,0) <> 0
								) RM2 
								INNER JOIN IMC.dbo.RM00101 CUS ON RM2.CUSTNMBR = CUS.CUSTNMBR
						GROUP BY
								RM2.CUSTNMBR,
								CUS.CUSTNAME,
								RM2.DUEDATE,
								RM2.TRXTYPE
						) DATA
						LEFT JOIN GPCustom.dbo.Companies CPY ON CPY.CompanyId = 'IMC'
				GROUP BY 
						DATA.CUSTNMBR,
						DATA.CUSTNAME,
						DATA.TRXTYPE,
						CPY.CompanyName
						) DATA1                
					) DATA2
				UNION
				SELECT	* 
				FROM	(
						SELECT	* 
						FROM	(
								SELECT	DATA.CUSTNMBR AS "Customer Number",
										DATA.CUSTNAME AS "Customer Name",
										SUM(DATA.[Current]) AS Current_Outstanding,
										SUM(DATA.[Days31_60]) AS Days31_60,
										SUM(DATA.[Days61_90]) AS Days61_90,
										SUM(DATA.[Days91_180]) AS Days91_180,
										SUM(DATA.[Days180More]) AS Days180More,
										DATA.TRXTYPE AS "Transaction Type",
										CPY.CompanyName AS "Company Name"
								FROM	(
										SELECT	RTRIM(RM2.CUSTNMBR) AS CUSTNMBR,
												CUS.CUSTNAME,
												SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) <= 30 THEN RM2.CURTRXAM ELSE 0 END) AS [Current],
												SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 31 AND 60 THEN RM2.CURTRXAM ELSE 0 END) AS [Days31_60],
												SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 61 AND 90 THEN RM2.CURTRXAM ELSE 0 END) AS [Days61_90],
												SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 91 AND 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days91_180],
												SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) > 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days180More],
												RM2.TRXTYPE
										FROM	(
												SELECT	CUSTNMBR,
														DUEDATE,
														CURTRXAM,
														TRXTYPE,
														BALANCE
												FROM	(
														SELECT	OPE.CUSTNMBR,
																OPE.DOCNUMBR,
																OPE.RMDTYPAL,
																OPE.DOCDATE,
																CASE WHEN OPE.RMDTYPAL < 6 THEN OPE.DOCDATE ELSE CASE WHEN OPE.DUEDATE < '01/01/1980' THEN CASE WHEN DAY.Days = 0 THEN CAST(GetDate() AS Varchar) ELSE DATEADD(dd, DAY.Days, OPE.DOCDATE) END ELSE OPE.DUEDATE END END AS DUEDATE,
																OPE.CURTRXAM * CASE WHEN OPE.RMDTYPAL > 6 THEN -1 ELSE 1 END AS CURTRXAM,
																BALANCE = OPE.CURTRXAM,
																CASE WHEN OPE.RMDTYPAL > 6 THEN 'Credit' ELSE 'Debit' END AS TRXTYPE
														FROM	AIS.dbo.RM20101 OPE
																INNER JOIN (
																			SELECT	CUSTNMBR,
																					ISNULL(PAYT.DUEDTDS, 0) AS Days
																			FROM	AIS.dbo.RM00101 CUST
																					LEFT JOIN AIS.dbo.SY03300 PAYT ON CUST.PYMTRMID = PAYT.PYMTRMID
																			) DAY ON OPE.CUSTNMBR = DAY.CUSTNMBR
														WHERE	OPE.VOIDSTTS = 0 
																AND OPE.CURTRXAM <> 0
														) DATA
												WHERE	ISNULL(BALANCE,0) <> 0
												) RM2
												INNER JOIN AIS.dbo.RM00101 CUS ON RM2.CUSTNMBR = CUS.CUSTNMBR
										GROUP BY
												RM2.CUSTNMBR,
												CUS.CUSTNAME,
												RM2.DUEDATE,
												RM2.TRXTYPE
										) DATA
										LEFT JOIN GPCustom.dbo.Companies CPY ON CPY.CompanyId = 'AIS'
								GROUP BY
										DATA.CUSTNMBR,
										DATA.CUSTNAME,
										DATA.TRXTYPE,
										CPY.CompanyName
								) DATA1
						)DATA2
				UNION
				SELECT	* 
				FROM	(
						SELECT	* 
						FROM	(
								SELECT	DATA.CUSTNMBR AS "Customer Number",
										DATA.CUSTNAME AS "Customer Name",
										SUM(DATA.[Current]) AS Current_Outstanding,
										SUM(DATA.[Days31_60]) AS Days31_60,
										SUM(DATA.[Days61_90]) AS Days61_90,
										SUM(DATA.[Days91_180]) AS Days91_180,
										SUM(DATA.[Days180More]) AS Days180More,
										DATA.TRXTYPE AS "Transaction Type",
										CPY.CompanyName AS "Company Name"
								FROM	(
										SELECT	RTRIM(RM2.CUSTNMBR) AS CUSTNMBR,
												CUS.CUSTNAME,
												SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) <= 30 THEN RM2.CURTRXAM ELSE 0 END) AS [Current],
												SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 31 AND 60 THEN RM2.CURTRXAM ELSE 0 END) AS [Days31_60],
												SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 61 AND 90 THEN RM2.CURTRXAM ELSE 0 END) AS [Days61_90],
												SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 91 AND 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days91_180],
												SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) > 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days180More],
												RM2.TRXTYPE
										FROM	(
												SELECT	CUSTNMBR,
														DUEDATE,
														CURTRXAM,
														TRXTYPE,
														BALANCE
												FROM	(
														SELECT	OPE.CUSTNMBR,
																OPE.DOCNUMBR,
																OPE.RMDTYPAL,
																OPE.DOCDATE,
																CASE WHEN OPE.RMDTYPAL < 6 THEN OPE.DOCDATE ELSE CASE WHEN OPE.DUEDATE < '01/01/1980' THEN CASE WHEN DAY.Days = 0 THEN CAST(GetDate() AS Varchar) ELSE DATEADD(dd, DAY.Days, OPE.DOCDATE) END ELSE OPE.DUEDATE END END AS DUEDATE,
																OPE.CURTRXAM * CASE WHEN OPE.RMDTYPAL > 6 THEN -1 ELSE 1 END AS CURTRXAM,
																BALANCE = OPE.CURTRXAM,
																CASE WHEN OPE.RMDTYPAL > 6 THEN 'Credit' ELSE 'Debit' END AS TRXTYPE
														FROM	DNJ.dbo.RM20101 OPE                                                                                                                                                                                                                                                                                                                                                                                 INNER JOIN                                                                                                                                                                                                                         (                                                                                                                                                                                                                                                                                                                                                                                                                                                              SELECT                                                                                                                                                 CUSTNMBR,                                                                                                                                                                                                                                                                       ISNULL(PAYT.DUEDTDS, 0) AS Days                                                                                                                                                                                                                                                                  FROM DNJ.dbo.RM00101 CUST                                                                                                                                                                                                                                                                                  LEFT JOIN DNJ.dbo.SY03300 PAYT                                                                                                                                                                                                                                                                                             ON CUST.PYMTRMID = PAYT.PYMTRMID                                                                                                                                                                                                                               ) DAY                                                                                                                                                                                                                     ON                                                                                                                                                                                                                         OPE.CUSTNMBR = DAY.CUSTNMBR                                                                                                                                                                                                                                                                                                                                          WHERE OPE.VOIDSTTS = 0 AND OPE.CURTRXAM <> 0                                                                                                                                                                                       ) DATA                                                                                                                                                                                                                                                                   WHERE ISNULL(BALANCE,0) <> 0                                                                                                                                                               ) RM2                                                                                                                                                                                                                    INNER JOIN DNJ.dbo.RM00101 CUS                                                                                                                                                                                 ON RM2.CUSTNMBR = CUS.CUSTNMBR                                                                                                                                                                                         GROUP BY                                                                                                                                                                                                                                           RM2.CUSTNMBR,                                                                                                                                                                                                                                             CUS.CUSTNAME,                                                                                                                                                                                                                                                                                                                                                                                              RM2.DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                 RM2.TRXTYPE                                    ) DATA                                                                  LEFT JOIN GPCustom.dbo.Companies CPY                                                                                                  ON CPY.CompanyId = 'DNJ'                                                                          GROUP BY                                                                                                                           DATA.CUSTNMBR,                                                                                                                                                           DATA.CUSTNAME,                                                                                                                                                                           DATA.TRXTYPE,                                                 CPY.CompanyName                        ) DATA1                )DATA2                                  UNION                 SELECT * FROM                 (                              SELECT * FROM                                 (                                              SELECT                                                  DATA.CUSTNMBR AS "Customer Number",                                                           DATA.CUSTNAME AS "Customer Name",                                                               SUM(DATA.[Current]) AS Current_Outstanding,                                                    SUM(DATA.[Days31_60]) AS Days31_60,                                                                SUM(DATA.[Days61_90]) AS Days61_90,                                                                SUM(DATA.[Days91_180]) AS Days91_180,                                                      SUM(DATA.[Days180More]) AS Days180More,                                                    DATA.TRXTYPE AS "Transaction Type",                                                    CPY.CompanyName AS "Company Name"                                                 FROM                                                                                                                  (                                                              SELECT                                                                  RTRIM(RM2.CUSTNMBR) AS CUSTNMBR,                                                                              CUS.CUSTNAME,                                                                              SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) <= 30 THEN RM2.CURTRXAM ELSE 0 END) AS [Current],                                                                        SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 31 AND 60 THEN RM2.CURTRXAM ELSE 0 END) AS [Days31_60],                                                                        SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 61 AND 90 THEN RM2.CURTRXAM ELSE 0 END) AS [Days61_90],                                                                                SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 91 AND 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days91_180],                                                                              SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) > 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days180More],                                                                  RM2.TRXTYPE                                                                    FROM                                                                    (                                                                                              SELECT                                                                                                  CUSTNMBR,                                                                                                       DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             CURTRXAM,                                                                                                                                                                                                                                                                                                                       TRXTYPE,                                                                                                             BALANCE                                                                                                                                                                                                            FROM                                                                                                                                                                                                  (                                                                                                                                                                                                                                                                                                                                              SELECT                                                                                                                                                                                                                                                 OPE.CUSTNMBR,                                                                                                                                                                                                                                              OPE.DOCNUMBR,                                                                                                                                                                                                                                            OPE.RMDTYPAL,                                                                                                                                                                                                                                               OPE.DOCDATE,                                                                                                                                                                                                                                                  CASE                                                                                                                                      WHEN OPE.RMDTYPAL < 6 THEN OPE.DOCDATE                                                                                                                                                                                                                                                   ELSE                                                                                                                                                                                                                                                                       CASE WHEN OPE.DUEDATE < '01/01/1980' THEN                                                                                                                                                                                                                                                                               CASE WHEN DAY.Days = 0 THEN CAST(GetDate() AS Varchar)                                                                                                                                                                                                                                                                        ELSE DATEADD(dd, DAY.Days, OPE.DOCDATE)                                                                                                                                                                                                                                                                                 END ELSE OPE.DUEDATE END                                                                                                                                                                                                                                      END AS DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            OPE.CURTRXAM * CASE                                                                                                                                                                                                                                                                 WHEN OPE.RMDTYPAL > 6 THEN -1                                                                                                                                                                                                                                                          ELSE 1                                                                                                                   END AS CURTRXAM,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        BALANCE = OPE.CURTRXAM,                                                                                                                              CASE                                                                                                                                      WHEN                                                                                                                                   OPE.RMDTYPAL > 6 THEN 'Credit'                                                                                                                                              ELSE 'Debit'                                                                                                                   END AS TRXTYPE                                                                                                               FROM NDS.dbo.RM20101 OPE                                                                                                                                                                                                                                                                                                                                                                   INNER JOIN                                                                                                                                                                                                                         (                                                                                                                                                                                                                                                                                                                                                                                                                                                               SELECT                                                                                                                                                 CUSTNMBR,                                                                                                                                                                                                                                                                       ISNULL(PAYT.DUEDTDS, 0) AS Days                                                                                                                                                                                                                                                            FROM NDS.dbo.RM00101 CUST                                                                                                                                                                                                                                                                                 LEFT JOIN NDS.dbo.SY03300 PAYT                                                                                                                                                                                                                                                                                            ON CUST.PYMTRMID = PAYT.PYMTRMID                                                                                                                                                                                                                                  ) DAY                                                                                                                                                                                                                                  ON                                                                                                                                                                                                                                  OPE.CUSTNMBR = DAY.CUSTNMBR                                                                                                                                                                                                                                                                                                                                          WHERE OPE.VOIDSTTS = 0 AND OPE.CURTRXAM <> 0                                                                                                                                                                                      ) DATA                                                                                                                                                                                                                                                                   WHERE ISNULL(BALANCE,0) <> 0                                                                                                                                                               ) RM2                                                                                                                                                                                                                    INNER JOIN NDS.dbo.RM00101 CUS                                                                                                                                                                         ON RM2.CUSTNMBR = CUS.CUSTNMBR                                                                                                                                                                                 GROUP BY                                                                                                                                                                                                                                            RM2.CUSTNMBR,                                                                                                                                                                                                                                             CUS.CUSTNAME,                                                                                                                                                                                                                                                                                                                                                                                              RM2.DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                 RM2.TRXTYPE                                    ) DATA                                                                  LEFT JOIN GPCustom.dbo.Companies CPY                                                                                                             ON CPY.CompanyId = 'NDS'                                                                          GROUP BY                                                                                                                                  DATA.CUSTNMBR,                                                                                                                                                           DATA.CUSTNAME,                                                                                                                                                                           DATA.TRXTYPE,                                                 CPY.CompanyName                        ) DATA1 )DATA2                                 UNION                 SELECT * FROM                 (                              SELECT * FROM                                 (                                              SELECT                                                  DATA.CUSTNMBR AS "Customer Number",                                                           DATA.CUSTNAME AS "Customer Name",                                                               SUM(DATA.[Current]) AS Current_Outstanding,                                                              SUM(DATA.[Days31_60]) AS Days31_60,                                                                SUM(DATA.[Days61_90]) AS Days61_90,                                                                SUM(DATA.[Days91_180]) AS Days91_180,                                                      SUM(DATA.[Days180More]) AS Days180More,                                                    DATA.TRXTYPE AS "Transaction Type",                                                    CPY.CompanyName AS "Company Name"                                                 FROM                                                                                                                  (                                                              SELECT                                                                  RTRIM(RM2.CUSTNMBR) AS CUSTNMBR,                                                                              CUS.CUSTNAME,                                                                              SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) <= 30 THEN RM2.CURTRXAM ELSE 0 END) AS [Current],                                                                        SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 31 AND 60 THEN RM2.CURTRXAM ELSE 0 END) AS [Days31_60],                                                                        SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 61 AND 90 THEN RM2.CURTRXAM ELSE 0 END) AS [Days61_90],                                                                                SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 91 AND 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days91_180],                                                                              SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) > 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days180More],                                                                                  RM2.TRXTYPE                                                                    FROM                                                                    (                                                                                              SELECT                                                                                                  CUSTNMBR,                                                                                                       DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             CURTRXAM,                                                                                                                                                                                                                                                                                                                       TRXTYPE,                                                                                                             BALANCE                                                                                                                                                                                                            FROM                                                                                                                                                                                                  (                                                                                                                                                                                                                                                                                                                                              SELECT                                                                                                                                                                                                                                                 OPE.CUSTNMBR,                                                                                                                                                                                                                                              OPE.DOCNUMBR,                                                                                                                                                                                                                                            OPE.RMDTYPAL,                                                                                                                                                                                                                                               OPE.DOCDATE,                                                                                                                                                                                                                                                  CASE                                                                                                                                      WHEN OPE.RMDTYPAL < 6 THEN OPE.DOCDATE                                                                                                                                                                                                                                                   ELSE                                                                                                                                                                                                                                                                       CASE WHEN OPE.DUEDATE < '01/01/1980' THEN                                                                                                                                                                                                                                                                               CASE WHEN DAY.Days = 0 THEN CAST(GetDate() AS Varchar)                                                                                                                                                                                                                                                                        ELSE DATEADD(dd, DAY.Days, OPE.DOCDATE)                                                                                                                                                                                                                                                                                 END ELSE OPE.DUEDATE END                                                                                                                                                                                                                                      END AS DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            OPE.CURTRXAM * CASE                                                                                                                                                                                                                                                                 WHEN OPE.RMDTYPAL > 6 THEN -1                                                                                                                                                                                                                                                          ELSE 1                                                                                                                   END AS CURTRXAM,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        BALANCE = OPE.CURTRXAM,                                                                                                                              CASE                                                                                                                                      WHEN                                                                                                                                   OPE.RMDTYPAL > 6 THEN 'Credit'                                                                                                                                              ELSE 'Debit'                                                                                                                   END AS TRXTYPE                                                                                                               FROM GLSO.dbo.RM20101 OPE                                                                                                                                                                                                                                                                                                                                                                 INNER JOIN                                                                                                                                                                                                                         (                                                                                                                                                                                                                                                                                                                                                                                                                                                               SELECT                                                                                                                                                 CUSTNMBR,                                                                                                                                                                                                                                                                       ISNULL(PAYT.DUEDTDS, 0) AS Days                                                                                                                                                                                                                                                            FROM GLSO.dbo.RM00101 CUST                                                                                                                                                                                                                                                                               LEFT JOIN GLSO.dbo.SY03300 PAYT                                                                                                                                                                                                                                                                                          ON CUST.PYMTRMID = PAYT.PYMTRMID                                                                                                                                                                                                                                  ) DAY                                                                                                                                                                                                                                  ON                                                                                                                                                                                                                                  OPE.CUSTNMBR = DAY.CUSTNMBR                                                                                                                                                                                                                                                                                                                                          WHERE OPE.VOIDSTTS = 0 AND OPE.CURTRXAM <> 0                                                                                                                                                                                      ) DATA                                                                                                                                                                                                                                                                   WHERE ISNULL(BALANCE,0) <> 0                                                                                                                                                               ) RM2                                                                                                                                                                                                                    INNER JOIN GLSO.dbo.RM00101 CUS                                                                                                                                                                       ON RM2.CUSTNMBR = CUS.CUSTNMBR                                                                                                                                                                                 GROUP BY                                                                                                                                                                                                                                            RM2.CUSTNMBR,                                                                                                                                                                                                                                             CUS.CUSTNAME,                                                                                                                                                                                                                                                                                                                                                                                              RM2.DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                 RM2.TRXTYPE                                    ) DATA                                                                  LEFT JOIN GPCustom.dbo.Companies CPY                                                                                                             ON CPY.CompanyId = 'GLSO'                                                                       GROUP BY                                                                                                                                  DATA.CUSTNMBR,                                                                                                                                                           DATA.CUSTNAME,                                                                                                                                                                           DATA.TRXTYPE,                                                 CPY.CompanyName                        ) DATA1 )DATA2                                 UNION                 SELECT * FROM                 (                              SELECT * FROM                                 (                                              SELECT                                                  DATA.CUSTNMBR AS "Customer Number",                                                           DATA.CUSTNAME AS "Customer Name",                                                               SUM(DATA.[Current]) AS Current_Outstanding,                                                              SUM(DATA.[Days31_60]) AS Days31_60,                                                                SUM(DATA.[Days61_90]) AS Days61_90,                                                                SUM(DATA.[Days91_180]) AS Days91_180,                                                      SUM(DATA.[Days180More]) AS Days180More,                                                    DATA.TRXTYPE AS "Transaction Type",                                                    CPY.CompanyName AS "Company Name"                                                 FROM                                                                                                                  (                                                              SELECT                                                                  RTRIM(RM2.CUSTNMBR) AS CUSTNMBR,                                                                              CUS.CUSTNAME,                                                                              SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) <= 30 THEN RM2.CURTRXAM ELSE 0 END) AS [Current],                                                                        SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 31 AND 60 THEN RM2.CURTRXAM ELSE 0 END) AS [Days31_60],                                                                        SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 61 AND 90 THEN RM2.CURTRXAM ELSE 0 END) AS [Days61_90],                                                                                SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 91 AND 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days91_180],                                                                              SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) > 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days180More],                                                                                  RM2.TRXTYPE                                                                    FROM                                                                    (                                                                                              SELECT                                                                                                  CUSTNMBR,                                                                                                       DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             CURTRXAM,                                                                                                                                                                                                                                                                                                                       TRXTYPE,                                                                                                             BALANCE                                                                                                                                                                                                            FROM                                                                                                                                                                                                  (                                                                                                                                                                                                                                                                                                                                              SELECT                                                                                                                                                                                                                                                 OPE.CUSTNMBR,                                                                                                                                                                                                                                              OPE.DOCNUMBR,                                                                                                                                                                                                                                            OPE.RMDTYPAL,                                                                                                                                                                                                                                               OPE.DOCDATE,                                                                                                                                                                                                                                                  CASE                                                                                                                                      WHEN OPE.RMDTYPAL < 6 THEN OPE.DOCDATE                                                                                                                                                                                                                                                   ELSE                                                                                                                                                                                                                                                                       CASE WHEN OPE.DUEDATE < '01/01/1980' THEN                                                                                                                                                                                                                                                                               CASE WHEN DAY.Days = 0 THEN CAST(GetDate() AS Varchar)                                                                                                                                                                                                                                                                        ELSE DATEADD(dd, DAY.Days, OPE.DOCDATE)                                                                                                                                                                                                                                                                                 END ELSE OPE.DUEDATE END                                                                                                                                                                                                                                      END AS DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            OPE.CURTRXAM * CASE                                                                                                                                                                                                                                                                 WHEN OPE.RMDTYPAL > 6 THEN -1                                                                                                                                                                                                                                                          ELSE 1                                                                                                                   END AS CURTRXAM,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        BALANCE = OPE.CURTRXAM,                                                                                                                              CASE                                                                                                                                      WHEN                                                                                                                                   OPE.RMDTYPAL > 6 THEN 'Credit'                                                                                                                                              ELSE 'Debit'                                                                                                                   END AS TRXTYPE                                                                                                               FROM OIS.dbo.RM20101 OPE                                                                                                                                                                                                                                                                                                                                                                     INNER JOIN                                                                                                                                                                                                                         (                                                                                                                                                                                                                                                                                                                                                                                                                                                               SELECT                                                                                                                                                 CUSTNMBR,                                                                                                                                                                                                                                                                       ISNULL(PAYT.DUEDTDS, 0) AS Days                                                                                                                                                                                                                                                            FROM OIS.dbo.RM00101 CUST                                                                                                                                                                                                                                                                   LEFT JOIN OIS.dbo.SY03300 PAYT                                                                                                                                                                                                                                                                                        ON CUST.PYMTRMID = PAYT.PYMTRMID                                                                                                                                                                                                                               ) DAY                                                                                                                                                                                                                     ON                                                                                                                                                                                                                         OPE.CUSTNMBR = DAY.CUSTNMBR                                                                                                                                                                                                                                                                                                                                               WHERE OPE.VOIDSTTS = 0 AND OPE.CURTRXAM <> 0                                                                                                                                                                                      ) DATA                                                                                                                                                                                                                                                                     WHERE ISNULL(BALANCE,0) <> 0                                                                                                                                                               ) RM2                                                                                                                                                                                                                    INNER JOIN OIS.dbo.RM00101 CUS                                                                                                                                                                           ON RM2.CUSTNMBR = CUS.CUSTNMBR                                                                                                                                                                                 GROUP BY                                                                                                                                                                                                                                           RM2.CUSTNMBR,                                                                                                                                                                                                                                              CUS.CUSTNAME,                                                                                                                                                                                                                                                                                                                                                                                              RM2.DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                   RM2.TRXTYPE                                    ) DATA                                                                  LEFT JOIN GPCustom.dbo.Companies CPY                                                                                                             ON CPY.CompanyId = 'OIS'                                                                   GROUP BY                                                                                                                           DATA.CUSTNMBR,                                                                                                                                                           DATA.CUSTNAME,                                                                                                                                                                           DATA.TRXTYPE,                                                 CPY.CompanyName                        ) DATA1                )DATA2                                  UNION                 SELECT * FROM                 (                              SELECT * FROM                                 (                                              SELECT                                                  DATA.CUSTNMBR AS "Customer Number",                                                           DATA.CUSTNAME AS "Customer Name",                                                               SUM(DATA.[Current]) AS Current_Outstanding,                                                    SUM(DATA.[Days31_60]) AS Days31_60,                                                                SUM(DATA.[Days61_90]) AS Days61_90,                                                                SUM(DATA.[Days91_180]) AS Days91_180,                                                      SUM(DATA.[Days180More]) AS Days180More,                                                    DATA.TRXTYPE AS "Transaction Type",                                                    CPY.CompanyName AS "Company Name"                                                 FROM                                                                                                                  (                                                              SELECT                                                                  RTRIM(RM2.CUSTNMBR) AS CUSTNMBR,                                                                              CUS.CUSTNAME,                                                                              SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) <= 30 THEN RM2.CURTRXAM ELSE 0 END) AS [Current],                                                                        SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 31 AND 60 THEN RM2.CURTRXAM ELSE 0 END) AS [Days31_60],                                                                        SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 61 AND 90 THEN RM2.CURTRXAM ELSE 0 END) AS [Days61_90],                                                                                SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) BETWEEN 91 AND 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days91_180],                                                                              SUM(CASE WHEN DATEDIFF(dd, RM2.DUEDATE, CAST(GetDate() AS Varchar)) > 180 THEN RM2.CURTRXAM ELSE 0 END) AS [Days180More],                                                                                  RM2.TRXTYPE                                                                    FROM                                                                    (                                                                                              SELECT                                                                                                  CUSTNMBR,                                                                                                       DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             CURTRXAM,                                                                                                                                                                                                                                                                                                                       TRXTYPE,                                                                                                             BALANCE                                                                                                                                                                                                            FROM                                                                                                                                                                                                  (                                                                                                                                                                                                                                                                                                                                              SELECT                                                                                                                                                                                                                                                 OPE.CUSTNMBR,                                                                                                                                                                                                                                              OPE.DOCNUMBR,                                                                                                                                                                                                                                            OPE.RMDTYPAL,                                                                                                                                                                                                                                               OPE.DOCDATE,                                                                                                                                                                                                                                                  CASE                                                                                                                                      WHEN OPE.RMDTYPAL < 6 THEN OPE.DOCDATE                                                                                                                                                                                                                                                   ELSE                                                                                                                                                                                                                                                                       CASE WHEN OPE.DUEDATE < '01/01/1980' THEN                                                                                                                                                                                                                                                                               CASE WHEN DAY.Days = 0 THEN CAST(GetDate() AS Varchar)                                                                                                                                                                                                                                                                        ELSE DATEADD(dd, DAY.Days, OPE.DOCDATE)                                                                                                                                                                                                                                                                                 END ELSE OPE.DUEDATE END                                                                                                                                                                                                                                      END AS DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            OPE.CURTRXAM * CASE                                                                                                                                                                                                                                                                 WHEN OPE.RMDTYPAL > 6 THEN -1                                                                                                                                                                                                                                                          ELSE 1                                                                                                                   END AS CURTRXAM,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        BALANCE = OPE.CURTRXAM,                                                                                                                              CASE                                                                                                                                      WHEN                                                                                                                                   OPE.RMDTYPAL > 6 THEN 'Credit'                                                                                                                                              ELSE 'Debit'                                                                                                                   END AS TRXTYPE                                                                                                               FROM GIS.dbo.RM20101 OPE                                                                                                                                                                                                                                                                                                                                                                     INNER JOIN                                                                                                                                                                                                                         (                                                                                                                                                                                                                                                                                                                                                                                                                                                               SELECT                                                                                                                                                 CUSTNMBR,                                                                                                                                                                                                                                                                       ISNULL(PAYT.DUEDTDS, 0) AS Days                                                                                                                                                                                                                                                            FROM GIS.dbo.RM00101 CUST                                                                                                                                                                                                                                                                   LEFT JOIN GIS.dbo.SY03300 PAYT                                                                                                                                                                                                                                                                                        ON CUST.PYMTRMID = PAYT.PYMTRMID                                                                                                                                                                                                                               ) DAY                                                                                                                                                                                                                     ON                                                                                                                                                                                                                         OPE.CUSTNMBR = DAY.CUSTNMBR                                                                                                                                                                                                                                                                                                                                               WHERE OPE.VOIDSTTS = 0 AND OPE.CURTRXAM <> 0                                                                                                                                                                                      ) DATA                                                                                                                                                                                                                                                                     WHERE ISNULL(BALANCE,0) <> 0                                                                                                                                                               ) RM2                                                                                                                                                                                                                    INNER JOIN GIS.dbo.RM00101 CUS                                                                                                                                                                           ON RM2.CUSTNMBR = CUS.CUSTNMBR                                                                                                                                                                                 GROUP BY                                                                                                                                                                                                                                           RM2.CUSTNMBR,                                                                                                                                                                                                                                              CUS.CUSTNAME,                                                                                                                                                                                                                                                                                                                                                                                              RM2.DUEDATE,                                                                                                                                                                                                                                                                                                                                                                                   RM2.TRXTYPE                                    ) DATA                                  LEFT JOIN GPCustom.dbo.Companies CPY                                                                                                  ON CPY.CompanyId = 'GIS'                                                                           GROUP BY                                                                                                                           DATA.CUSTNMBR,                                                                                                                                                           DATA.CUSTNAME,                                                                                                                                                                           DATA.TRXTYPE,                                                 CPY.CompanyName                        ) DATA1                )DATA2 )DATA3