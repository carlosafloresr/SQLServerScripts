SELECT	* 
FROM	PM10100 
WHERE	VCHRNMBR = 'FPT_C110129-' NOT IN (SELECT VCHNUMWK FROM PM10000)
		AND VCHRNMBR NOT IN (SELECT VCHRNMBR FROM PM20000)
		AND LEFT(VendorId, 1) = 'D'
select	*
from	 DELETE PM10000
where	BachNumb = 'FPT20110129'
/*
SELECT * FROM PM30300 WHERE ApToDcnm = '853729'
SELECT * FROM PM30300 WHERE APFRDCNM = '853729'
SELECT * FROM PM30300 WHERE VCHRNMBR = '00000000000021853'
SELECT * FROM PM20000 WHERE VendorId = '454'
SELECT * FROM PM30600 WHERE VendorId = '454'
SELECT * FROM PM30200 WHERE DocNumbr = '853729'
SELECT * FROM PM30200 WHERE DocNumbr = 'WE11/06,11/13/10'
UPDATE PM30200 SET CurTrxAm = DocAmnt, Voided = 0 WHERE DocNumbr = '501-10-000554'
UPDATE PM20000 SET DueDate = DocDate + 30 WHERE VendorId = '369'
SELECT * FROM PM10000 WHERE VCHNUMWK = '00000000000027196'
SELECT * FROM PM10000 WHERE BachNumb = '111810LCCK-2'
SELECT * FROM PM00400 WHERE CntrlNum = '00000000000039916'
SELECT * FROM PM00400 WHERE DocNumbr = 'WE11/06,11/13/10'
SELECT * FROM PM10300 WHERE PmntNmbr = '00000000000039916'
SELECT * FROM PM10200 WHERE ApToDcnm = '501-10-000554'
SELECT * FROM PM10200 WHERE VCHRNMBR = '00000000000022027'
SELECT * FROM PM10200 WHERE APFRDCNM = '501-10-000554'
SELECT * FROM PM10201 WHERE PMNTNMBR = '501-10-000554' OR APFVCHNM = '501-10-000554' OR APTVCHNM = '501-10-000554'
SELECT * FROM PM20100 WHERE APTVCHNM = '00000000000022027' OR APTODCNM = '501-10-000554'

SELECT * FROM PM00400 WHERE VendorId = ''

SELECT * FROM DNJ..SY00500 WHERE BACHNUMB = '111810LCCK-2'

-- PAYMENTS
SELECT	* 
--INTO	PM10300_11172010
FROM	PM10300 
WHERE	PmntNmbr NOT IN (SELECT VCHNUMWK FROM PM10000)
		AND PmntNmbr NOT IN (SELECT VCHRNMBR FROM PM20000)
		AND LEFT(VendorId, 1) = 'D'
ORDER BY PmntNmbr

-- APPLY TO
SELECT	* 
--INTO	PM10200_11172010
FROM	PM10200 
WHERE	VCHRNMBR NOT IN (SELECT VCHNUMWK FROM PM10000)
		AND VCHRNMBR NOT IN (SELECT VCHRNMBR FROM PM20000)
		AND VCHRNMBR NOT IN (SELECT VCHRNMBR FROM PM30200)
		AND LEFT(VendorId, 1) = 'D'
		--AND DOCDATE = '11/17/2010'
ORDER BY VCHRNMBR

-- DOCUMENT MASTER
SELECT	* 
--INTO	PM00400_11172010
FROM	PM00400 
WHERE	CntrlNum NOT IN (SELECT VCHNUMWK FROM PM10000)
		AND CntrlNum NOT IN (SELECT VCHRNMBR FROM PM20000)
		AND CntrlNum NOT IN (SELECT VCHRNMBR FROM PM30200)
		AND LEFT(VendorId, 1) = 'D'


EXECUTE USP_Fix_ApplyTo_AP '00000000000021853','853729'

--**********************************************************
--****       FIX THE BALANCE OF OPEN TRANSACTIONS       ****
--**********************************************************
DECLARE	@Voucher	Varchar(25),
		@DocNumbr	Varchar(30)

--DECLARE Transactions CURSOR LOCAL KEYSET OPTIMISTIC FOR SELECT VCHRNMBR, DocNumbr FROM PM20000
DECLARE Transactions CURSOR LOCAL KEYSET OPTIMISTIC FOR SELECT VCHRNMBR, DocNumbr FROM PM30200 --WHERE VendorId = '149'

OPEN Transactions 
FETCH FROM Transactions INTO @Voucher, @DocNumbr

BEGIN TRANSACTION

WHILE @@FETCH_STATUS = 0 
BEGIN
	EXECUTE USP_Fix_ApplyTo_AP @Voucher, @DocNumbr
	
	FETCH FROM Transactions INTO @Voucher, @DocNumbr
END

IF @@ERROR = 0
BEGIN
	COMMIT TRANSACTION
END
ELSE
BEGIN
	ROLLBACK TRANSACTION
END

CLOSE Transactions
DEALLOCATE Transactions

GO

--**********************************************************
*/