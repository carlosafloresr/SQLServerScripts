DECLARE @Document	Varchar(30) = Null,
		@BatchId	Varchar(15) = LEFT('9FSI20230125_1451', 15), -- 651577731
		@GLAcct		Varchar(12) = Null

SELECT	DISTINCT PM20.BACHNUMB,
		PM20.VCHRNMBR,
		PM20.DOCNUMBR,
		PM20.VENDORID,
		RTRIM(PM20.TRXDSCRN) AS [DESCRIPTION],
		PM10.DistRef AS DistribtionReference,
		CAST(PM20.DOCDATE AS Date) AS [DATE],
		RTRIM(GL5.ACTNUMST) AS ACCOUNT,
		RTRIM(GL1.ACTDESCR) AS ACCT_Description,
		CAST(PM10.DEBITAMT AS Numeric(10,2)) AS DEBIT,
		CAST(PM10.CRDTAMNT AS Numeric(10,2)) AS CREDIT,
		PM10.DSTSQNUM,
		'Work' AS DatSource,
		RTRIM(PM20.DOCNUMBR) AS DocumentNumber,
		'' AS SOURCDOC
FROM	PM10000 PM20
		LEFT JOIN PM10100 PM10 ON PM20.VENDORID = PM10.VENDORID AND PM20.VCHRNMBR = PM10.VCHRNMBR
		LEFT JOIN GL00105 GL5 ON PM10.DSTINDX = GL5.ACTINDX
		LEFT JOIN GL00100 GL1 on GL5.ACTINDX = GL1.ACTINDX
WHERE	((@Document IS NOT Null AND PM20.DOCNUMBR = @Document)
		OR (@BatchId IS NOT Null AND PM20.BACHNUMB = @BatchId)
		OR (@GLAcct IS NOT Null AND GL5.ACTNUMST = @GLAcct))
		AND PM20.VCHRNMBR <> ''
		--AND PM20.DOCDATE BETWEEN '01/05/2020' AND '07/22/2022'
UNION
SELECT	DISTINCT PM20.BACHNUMB,
		PM20.VCHRNMBR,
		PM20.DOCNUMBR,
		PM20.VENDORID,
		RTRIM(PM20.TRXDSCRN) AS [DESCRIPTION],
		PM10.DistRef,
		CAST(PM20.DOCDATE AS Date) AS [DATE],
		RTRIM(GL5.ACTNUMST) AS ACCOUNT,
		RTRIM(GL1.ACTDESCR) AS ACCT_Description,
		CAST(PM10.DEBITAMT AS Numeric(10,2)) AS DEBIT,
		CAST(PM10.CRDTAMNT AS Numeric(10,2)) AS CREDIT,
		PM10.DSTSQNUM,
		'Open' AS DatSource,
		RTRIM(PM20.DOCNUMBR) AS DocumentNumber,
		'' AS SOURCDOC
FROM	PM20000 PM20
		LEFT JOIN PM10100 PM10 ON PM20.VENDORID = PM10.VENDORID AND PM20.VCHRNMBR = PM10.VCHRNMBR
		LEFT JOIN GL00105 GL5 ON PM10.DSTINDX = GL5.ACTINDX
		LEFT JOIN GL00100 GL1 on GL5.ACTINDX = GL1.ACTINDX
WHERE	((@Document IS NOT Null AND PM20.DOCNUMBR = @Document)
		OR (@BatchId IS NOT Null AND PM20.BACHNUMB = @BatchId)
		OR (@GLAcct IS NOT Null AND GL5.ACTNUMST = @GLAcct))
		--AND PM20.DOCDATE BETWEEN '01/05/2020' AND '07/22/2022'
UNION
SELECT	DISTINCT PM20.BACHNUMB,
		PM20.VCHRNMBR,
		PM20.DOCNUMBR,
		PM20.VENDORID,
		RTRIM(PM20.TRXDSCRN) AS [DESCRIPTION],
		PM10.DistRef,
		CAST(PM20.DOCDATE AS Date) AS [DATE],
		RTRIM(GL5.ACTNUMST) AS ACCOUNT,
		RTRIM(GL1.ACTDESCR) AS ACCT_Description,
		CAST(PM10.DEBITAMT AS Numeric(10,2)) AS DEBIT,
		CAST(PM10.CRDTAMNT AS Numeric(10,2)) AS CREDIT,
		PM10.DSTSQNUM,
		'History' AS DatSource,
		RTRIM(PM20.DOCNUMBR) AS DocumentNumber,
		'' AS SOURCDOC
FROM	PM30200 PM20
		LEFT JOIN PM30600 PM10 ON PM20.VENDORID = PM10.VENDORID AND PM20.VCHRNMBR = PM10.VCHRNMBR
		LEFT JOIN GL00105 GL5 ON PM10.DSTINDX = GL5.ACTINDX
		LEFT JOIN GL00100 GL1 on GL5.ACTINDX = GL1.ACTINDX
WHERE	((@Document IS NOT Null AND PM20.DOCNUMBR = @Document)
		OR (@BatchId IS NOT Null AND PM20.BACHNUMB = @BatchId)
		OR (@GLAcct IS NOT Null AND GL5.ACTNUMST = @GLAcct))
		--AND PM20.DOCDATE BETWEEN '01/05/2020' AND '07/22/2022'
ORDER BY 1, 2, 10, 8, 7