/*
CREATE PROCEDURE USP_PullInvoiceData (@Inv_No	Int)
*/
DECLARE	@Inv_No		Int,
		@Acct_No	Varchar(10)
		
SET		@Inv_No = 617820

SELECT	inv_no, 
		sbt_no, 
		acct_no, 
		inv_date, 
		inv_total, 
		inv_type, 
		inv_mech, 
		container, 
		chassis, 
		genset_no, 
		labor_hour, 
		labor, 
		parts, 
		tirerpl, 
		tirerpr, 
		size, 
		sale_tax1, 
		sale_tax2, 
		unit_f, 
		tir_no, 
		gen_ser, 
		gen_mod, 
		gen_hours, 
		driver, 
		inv_batch, 
		fhwa, 
		inv_format, 
		approval, 
		cdex_lesee, 
		cdex_dpp, 
		cedxonhir, 
		fhwaappv, 
		eq_datein, 
		mfg_date, 
		rep_date, 
		workorder, 
		inv_remk 
INTO	#tmpInvoice
FROM	FI.FI_Data.dbo.Invoices 
WHERE	Inv_No = @Inv_No

SELECT	@Acct_No = Acct_No
FROM	#tmpInvoice

IF NOT EXISTS(SELECT Acct_No FROM Accounts WHERE Acct_No = @Acct_No)
BEGIN
	INSERT INTO Accounts
			(Acct_No, 
			Acct_Name, 
			BAddress, 
			BAddress1, 
			BCity, 
			BState, 
			BZip, 
			BContact, 
			Vencode, 
			ECurrency)
	SELECT	Acct_No, 
			Acct_Name, 
			BAddress, 
			BAddress1, 
			BCity, 
			BState, 
			BZip, 
			BContact, 
			Vencode, 
			ECurrency
	FROM	FI.FI_Data.dbo.Accounts
	WHERE	Acct_No = @Acct_No
END

DELETE Invoices WHERE Inv_No = @Inv_No

INSERT INTO dbo.Invoices
		(inv_no, 
		sbt_no, 
		acct_no, 
		inv_date, 
		inv_total, 
		inv_type, 
		inv_mech, 
		container, 
		chassis, 
		genset_no, 
		labor_hour, 
		labor, 
		parts, 
		tirerpl, 
		tirerpr, 
		size, 
		sale_tax1, 
		sale_tax2, 
		unit_f, 
		tir_no, 
		gen_ser, 
		gen_mod, 
		gen_hours, 
		driver, 
		inv_batch, 
		fhwa, 
		inv_format, 
		approval, 
		cdex_lesee, 
		cdex_dpp, 
		cedxonhir, 
		fhwaappv, 
		eq_datein, 
		mfg_date, 
		rep_date, 
		workorder, 
		inv_remk)
SELECT	inv_no, 
		sbt_no, 
		acct_no, 
		inv_date, 
		inv_total, 
		inv_type, 
		inv_mech, 
		container, 
		chassis, 
		genset_no, 
		labor_hour, 
		labor, 
		parts, 
		tirerpl, 
		tirerpr, 
		size, 
		sale_tax1, 
		sale_tax2, 
		unit_f, 
		tir_no, 
		gen_ser, 
		gen_mod, 
		gen_hours, 
		driver, 
		inv_batch, 
		fhwa, 
		inv_format, 
		approval, 
		cdex_lesee, 
		cdex_dpp, 
		cedxonhir, 
		fhwaappv, 
		eq_datein, 
		mfg_date, 
		rep_date, 
		workorder, 
		inv_remk  
FROM	#tmpInvoice

DELETE Sale WHERE Inv_No = @Inv_No

INSERT INTO Sale
		(inv_no, 
		part_no, 
		descript, 
		qty_shiped,
		unit_price, 
		part_total, 
		itemtot, 
		repaircd,
		damagecd, 
		partscd, 
		cdex_party, 
		cdex_damag,
		cdex_repai, 
		cdex_compo, 
		cdex_locat, 
		cdex_lengt,
		cdex_width, 
		dpart_no, 
		rlabor, 
		rlabor_qty,
		newdoton, 
		newdotoff, 
		lpart_no, 
		idcs_ym, 
		idcs_loc,
		idcs_cond)
SELECT	inv_no, 
		part_no, 
		descript, 
		qty_shiped,
		unit_price, 
		part_total, 
		itemtot, 
		repaircd,
		damagecd, 
		partscd, 
		cdex_party, 
		cdex_damag,
		cdex_repai, 
		cdex_compo, 
		cdex_locat, 
		cdex_lengt,
		cdex_width, 
		dpart_no, 
		rlabor, 
		rlabor_qty,
		newdoton, 
		newdotoff, 
		lpart_no, 
		idcs_ym, 
		idcs_loc,
		idcs_cond
FROM	FI.FI_Data.dbo.Sale
WHERE	Inv_No = @Inv_No

DROP TABLE #tmpInvoice